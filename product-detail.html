<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Details - Malawi Furniture Store</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>

  <!-- Header (same as index.html) -->
  <header>
    <nav class="navbar">
      <div class="nav-logo">
        <a href="index.html"><img src="assets/logo.png" alt="Logo"></a>
      </div>
      <div class="nav-search">
        <input type="text" placeholder="Search products..." class="search-input">
        <div class="search-icon"><span class="material-symbols-outlined">search</span></div>
      </div>
      <div class="cart">
        <a href="cart.html">
          <span class="material-symbols-outlined cart-icon">shopping_cart</span>
          <span id="cartCount">0</span>
        </a>
        <p>Cart</p>
      </div>
    </nav>
    <div class="banner">
      <div class="banner-content">
        <div class="panel"><span class="material-symbols-outlined">menu</span><a href="index.html">All</a></div>
      </div>
    </div>
  </header>

  <!-- Product Detail Section -->
  <section class="detail-section">
    <div class="detail-container">
      <div class="detail-image">
        <img id="detailImg" src="" alt="Loading product image...">
      </div>
      <div class="detail-info">
        <h1 id="detailTitle">Loading product...</h1>
        <div class="detail-price" id="detailPrice">0 MKW</div>
        <p class="detail-desc" id="detailDesc">
          High-quality handcrafted furniture made in Malawi. Durable, stylish, and built to last.
        </p>
        <button class="add-to-cart-btn" onclick="addToCartFromDetail()">
          Add to Cart
        </button>
        <a href="index.html" class="back-link">← Back to Shop</a>
      </div>
    </div>
  </section>

  <!-- Footer (same as index.html) -->
  <footer>
    <a href="index.html" class="footer-title">Back to top</a>
    <div class="footer-items">
      <ul><h3>Get to Know Us</h3><li><a href="#">About Us</a></li></ul>
      <ul><h3>Connect</h3><li><a href="#">Facebook</a></li></ul>
      <ul><h3>Make Money</h3><li><a href="#">Sell Here</a></li></ul>
      <ul><h3>Help</h3><li><a href="#">Contact</a></li></ul>
    </div>
  </footer>

  <!-- JavaScript (logic only) -->
  <script>
    const API_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // ← CHANGE THIS!

    // Cart functions
    function getCart() { return JSON.parse(localStorage.getItem("cart") || "[]"); }
    function saveCart(cart) {
      localStorage.setItem("cart", JSON.stringify(cart));
      document.getElementById("cartCount").textContent = cart.reduce((s,i)=>s+i.qty,0);
    }
    function addToCart(product) {
      let cart = getCart();
      const existing = cart.find(i => i.title === product.title);
      if (existing) existing.qty += 1;
      else cart.push({ ...product, qty: 1 });
      saveCart(cart);
      alert(`${product.title} added to cart!`);
    }

    // Load product from URL parameter
    const params = new URLSearchParams(window.location.search);
    const productTitle = decodeURIComponent(params.get("title") || "");

    async function loadProductDetail() {
      try {
        const res = await fetch(API_URL + "?t=" + Date.now());
        const products = await res.json();
        const product = products.find(p => p.title === productTitle);

        if (!product) {
          document.querySelector(".detail-container").innerHTML = "<h2 style='text-align:center;padding:100px;color:#999;'>Product not found</h2>";
          return;
        }

        document.getElementById("detailImg").src = product.image;
        document.getElementById("detailTitle").textContent = product.title;
        document.getElementById("detailPrice").textContent = parseFloat(product.price).toLocaleString() + " MKW";

        if (product.description) {
          document.getElementById("detailDesc").textContent = product.description;
        }

        window.addToCartFromDetail = () => addToCart({
          title: product.title,
          price: product.price,
          image: product.image
        });

        saveCart(getCart()); // Update cart count

      } catch (err) {
        document.body.innerHTML += "<p style='text-align:center;color:red;'>Failed to load product. Please try again.</p>";
      }
    }

    loadProductDetail();
  </script>
</body>
</html>
